import{a as ve,b as ge}from"./chunk-LEVZNI3I.js";import{a as ce}from"./chunk-GCH5KP3H.js";import{a as pe}from"./chunk-KQRGWYIZ.js";import{A as O,C as ee,D as F,F as U,G as te,H as I,I as ie,J as re,M as se,N as ne,Q as ae,Z as oe,_ as he,aa as le,ba as ue,d as X,e as J,ea as fe,h as K,p as E,q as k,s as H,u as $,x as _}from"./chunk-GSMEW25H.js";import{a as de}from"./chunk-PDOTELFB.js";import{Ga as Q,Ha as Y,Ia as Z,O as z,P as v,Q as D,W,ca as L,ia as V,ja as B,ka as q,u as M}from"./chunk-VURGYMKM.js";var d=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return e===0?0:e===1?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(e){var t=1.70158;return e===1?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return e===0?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-d.Bounce.Out(1-e)},Out:function(e){return e<.36363636363636365?7.5625*e*e:e<.7272727272727273?7.5625*(e-=.5454545454545454)*e+.75:e<.9090909090909091?7.5625*(e-=.8181818181818182)*e+.9375:7.5625*(e-=.9545454545454546)*e+.984375},InOut:function(e){return e<.5?d.Bounce.In(e*2)*.5:d.Bounce.Out(e*2-1)*.5+.5}}),generatePow:function(e){return e===void 0&&(e=4),e=e<Number.EPSILON?Number.EPSILON:e,e=e>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(t*2,e)/2:(1-Math.pow(2-t*2,e))/2+.5}}}}),C=function(){return performance.now()},Te=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(i){return t._tweens[i]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},e.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},e.prototype.update=function(t,i){t===void 0&&(t=C()),i===void 0&&(i=!1);var r=Object.keys(this._tweens);if(r.length===0)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<r.length;s++){var n=this._tweens[r[s]],a=!i;n&&n.update(t,a)===!1&&!i&&delete this._tweens[r[s]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),y={Linear:function(e,t){var i=e.length-1,r=i*t,s=Math.floor(r),n=y.Utils.Linear;return t<0?n(e[0],e[1],r):t>1?n(e[i],e[i-1],i-r):n(e[s],e[s+1>i?i:s+1],r-s)},Bezier:function(e,t){for(var i=0,r=e.length-1,s=Math.pow,n=y.Utils.Bernstein,a=0;a<=r;a++)i+=s(1-t,r-a)*s(t,a)*e[a]*n(r,a);return i},CatmullRom:function(e,t){var i=e.length-1,r=i*t,s=Math.floor(r),n=y.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(s=Math.floor(r=i*(1+t))),n(e[(s-1+i)%i],e[s],e[(s+1)%i],e[(s+2)%i],r-s)):t<0?e[0]-(n(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[i]-(n(e[i],e[i],e[i-1],e[i-1],r-i)-e[i]):n(e[s?s-1:0],e[s],e[i<s+1?i:s+1],e[i<s+2?i:s+2],r-s)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=y.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t])return e[t];for(var r=t;r>1;r--)i*=r;return e[t]=i,i}}(),CatmullRom:function(e,t,i,r,s){var n=(i-e)*.5,a=(r-t)*.5,o=s*s,h=s*o;return(2*t-2*i+n+a)*h+(-3*t+3*i-2*n-a)*o+n*s+t}}},me=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),G=new Te,T=function(){function e(t,i){i===void 0&&(i=G),this._object=t,this._group=i,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=d.Linear.None,this._interpolationFunction=y.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=me.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(t,i){if(i===void 0&&(i=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=i<0?0:i,this},e.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t<0?0:t,this},e.prototype.dynamic=function(t){return t===void 0&&(t=!1),this._isDynamic=t,this},e.prototype.start=function(t,i){if(t===void 0&&(t=C()),i===void 0&&(i=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||i){if(this._propertiesAreSetUp=!0,!this._isDynamic){var s={};for(var n in this._valuesEnd)s[n]=this._valuesEnd[n];this._valuesEnd=s}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,i)}return this},e.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},e.prototype._setupProperties=function(t,i,r,s,n){for(var a in r){var o=t[a],h=Array.isArray(o),u=h?"array":typeof o,f=!h&&Array.isArray(r[a]);if(!(u==="undefined"||u==="function")){if(f){var l=r[a];if(l.length===0)continue;for(var c=[o],m=0,b=l.length;m<b;m+=1){var R=this._handleRelativeValue(o,l[m]);if(isNaN(R)){f=!1,console.warn("Found invalid interpolation list. Skipping.");break}c.push(R)}f&&(r[a]=c)}if((u==="object"||h)&&o&&!f){i[a]=h?[]:{};var w=o;for(var g in w)i[a][g]=w[g];s[a]=h?[]:{};var l=r[a];if(!this._isDynamic){var S={};for(var g in l)S[g]=l[g];r[a]=l=S}this._setupProperties(w,i[a],l,s[a],n)}else(typeof i[a]>"u"||n)&&(i[a]=o),h||(i[a]*=1),f?s[a]=r[a].slice().reverse():s[a]=i[a]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(t){return t===void 0&&(t=C()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},e.prototype.resume=function(t){return t===void 0&&(t=C()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},e.prototype.stopChainedTweens=function(){for(var t=0,i=this._chainedTweens.length;t<i;t++)this._chainedTweens[t].stop();return this},e.prototype.group=function(t){return t===void 0&&(t=G),this._group=t,this},e.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},e.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},e.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},e.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},e.prototype.easing=function(t){return t===void 0&&(t=d.Linear.None),this._easingFunction=t,this},e.prototype.interpolation=function(t){return t===void 0&&(t=y.Linear),this._interpolationFunction=t,this},e.prototype.chain=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return this._chainedTweens=t,this},e.prototype.onStart=function(t){return this._onStartCallback=t,this},e.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},e.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},e.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},e.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},e.prototype.onStop=function(t){return this._onStopCallback=t,this},e.prototype.update=function(t,i){var r=this,s;if(t===void 0&&(t=C()),i===void 0&&(i=!0),this._isPaused)return!0;var n,a=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>a)return!1;i&&this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=t-this._startTime,h=this._duration+((s=this._repeatDelayTime)!==null&&s!==void 0?s:this._delayTime),u=this._duration+this._repeat*h,f=function(){if(r._duration===0||o>u)return 1;var w=Math.trunc(o/h),g=o-w*h,S=Math.min(g/r._duration,1);return S===0&&o===r._duration?1:S},l=f(),c=this._easingFunction(l);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,c),this._onUpdateCallback&&this._onUpdateCallback(this._object,l),this._duration===0||o>=this._duration)if(this._repeat>0){var m=Math.min(Math.trunc((o-this._duration)/h)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=m);for(n in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[n]=="string"&&(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=h*m,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var b=0,R=this._chainedTweens.length;b<R;b++)this._chainedTweens[b].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(t,i,r,s){for(var n in r)if(i[n]!==void 0){var a=i[n]||0,o=r[n],h=Array.isArray(t[n]),u=Array.isArray(o),f=!h&&u;f?t[n]=this._interpolationFunction(o,s):typeof o=="object"&&o?this._updateProperties(t[n],a,o,s):(o=this._handleRelativeValue(a,o),typeof o=="number"&&(t[n]=a+(o-a)*s))}},e.prototype._handleRelativeValue=function(t,i){return typeof i!="string"?i:i.charAt(0)==="+"||i.charAt(0)==="-"?t+parseFloat(i):parseFloat(i)},e.prototype._swapEndStartRepeatValues=function(t){var i=this._valuesStartRepeat[t],r=this._valuesEnd[t];typeof r=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(r):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=i},e}();var Re=me.nextId,p=G,Me=p.getAll.bind(p),N=p.removeAll.bind(p),He=p.add.bind(p),Ie=p.remove.bind(p),Ee=p.update.bind(p);var x=class extends I{color;size;pointCount;rangeH;rangeV;speed;speedTarget;points;constructor(t){super(),this.color=t.color||3355443,this.size=t.size||.4,this.pointCount=t.pointCount||40,this.rangeH=t.rangeH||1,this.rangeV=t.rangeV||2,this.speed=this.speedTarget=t.speed||5e-4;let i=document.createElement("canvas");i.width=i.height=128;let r=i.getContext("2d"),s=i.width/2,n=i.height/2,a=i.width/3;r.beginPath(),r.arc(s,n,a,0,2*Math.PI,!1),r.fillStyle="#fff",r.fill();let o=new $(i);o.premultiplyAlpha=!0,o.needsUpdate=!0;let h=new ee,u=new Float32Array(this.pointCount*3),f=new Float32Array(this.pointCount*3);for(let c=0;c<this.pointCount;c++)u[c*3]=E.randFloatSpread(this.rangeH),u[c*3+1]=E.randFloatSpread(this.rangeV),u[c*3+2]=E.randFloatSpread(this.rangeH),f[c*3+1]=-Math.random()*this.speed*100;h.setAttribute("position",new O(u,3)),h.setAttribute("velocity",new O(f,3));let l=new se({color:this.color,size:this.size,map:o,transparent:!0,depthWrite:!1});this.points=new ne(h,l),this.points.position.y=-this.rangeV/2,this.add(this.points)}updateConstant(){let t=this.points.geometry.attributes.position.array,i=this.points.geometry.attributes.velocity.array;for(let r=0;r<this.pointCount;r++)t[r*3+1]<-this.rangeV/2&&(t[r*3+1]=this.rangeV/2),t[r*3+1]-=this.speed;this.points.geometry.attributes.position.needsUpdate=!0}};var A=class e{fireMaterial=null;createOutlineMaterial(){return new U({uniforms:{offset:{value:.3},color:{value:new _("#000000")},alpha:{value:1}},vertexShader:`
        uniform float offset;
        void main() {
          vec4 pos = modelViewMatrix * vec4(position + normal * offset, 1.0);
          gl_Position = projectionMatrix * pos;
        }
      `,fragmentShader:`
        uniform vec3 color;
        uniform float alpha;
        void main() {
          gl_FragColor = vec4(color, alpha);
        }
      `,side:X})}createFireMaterial(){return this.fireMaterial=new U({uniforms:{time:{value:0},intensity:{value:1},fireHeight:{value:1},baseColor:{value:new _(3342336)},midColor:{value:new _(16729088)},topColor:{value:new _(16777096)},hotColor:{value:new _(8965375)}},vertexShader:`
        varying vec2 vUv;
        varying vec3 vPosition;
        
        void main() {
          vUv = uv;
          vPosition = position;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        uniform float time;
        uniform float intensity;
        uniform float fireHeight;
        uniform vec3 baseColor;
        uniform vec3 midColor;
        uniform vec3 topColor;
        uniform vec3 hotColor;
        
        varying vec2 vUv;
        varying vec3 vPosition;
        
        // \u041F\u0440\u043E\u0441\u0442\u0430\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u044F \u0448\u0443\u043C\u0430
        float random(vec2 st) {
          return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
        }
        
        // \u0421\u043C\u0435\u0448\u0430\u043D\u043D\u044B\u0439 \u0448\u0443\u043C
        float noise(vec2 st) {
          vec2 i = floor(st);
          vec2 f = fract(st);
          
          float a = random(i);
          float b = random(i + vec2(1.0, 0.0));
          float c = random(i + vec2(0.0, 1.0));
          float d = random(i + vec2(1.0, 1.0));
          
          vec2 u = f * f * (3.0 - 2.0 * f);
          
          return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
        }
        
        // \u0424\u0440\u0430\u043A\u0442\u0430\u043B\u044C\u043D\u044B\u0439 \u0448\u0443\u043C (fBm - fractional Brownian motion)
        float fbm(vec2 st) {
          float value = 0.0;
          float amplitude = 1.0;
          float frequency = 1.0;
          
          for(int i = 0; i < 4; i++) {
            value += amplitude * noise(st * frequency);
            amplitude *= 0.5;
            frequency *= 2.0;
          }
          
          return value;
        }
        
        void main() {
          vec2 st = vUv;
          
          // \u041F\u0440\u0438\u043C\u0435\u043D\u044F\u0435\u043C fireHeight \u043A \u0432\u044B\u0441\u043E\u0442\u0435 \u043E\u0433\u043D\u044F
          float scaledY = st.y / fireHeight;
          
          // \u0421\u043E\u0437\u0434\u0430\u0435\u043C \u043E\u0441\u043D\u043E\u0432\u043D\u0443\u044E \u0444\u043E\u0440\u043C\u0443 \u043E\u0433\u043D\u044F
          float fireShape = 1.0 - scaledY;
          fireShape *= (1.0 - abs(st.x - 0.5) * 2.0); // \u0441\u0443\u0436\u0430\u0435\u043C \u043A \u043A\u0440\u0430\u044F\u043C
          
          // \u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u0430\u043D\u0438\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0439 \u0448\u0443\u043C \u0434\u043B\u044F \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F "\u0442\u0430\u043D\u0446\u0430" \u043E\u0433\u043D\u044F
          vec2 distortion = vec2(
            fbm(st * 3.0 + vec2(time * 0.5, time * 0.8)) * 0.3,
            fbm(st * 2.0 + vec2(time * 0.3, time * 0.6)) * 0.4
          );
          
          // \u041F\u0440\u0438\u043C\u0435\u043D\u044F\u0435\u043C \u0438\u0441\u043A\u0430\u0436\u0435\u043D\u0438\u0435
          vec2 distortedUV = st + distortion * fireShape;
          
          // \u0421\u043E\u0437\u0434\u0430\u0435\u043C \u0442\u0443\u0440\u0431\u0443\u043B\u0435\u043D\u0442\u043D\u043E\u0441\u0442\u044C
          float turbulence = fbm(distortedUV * 6.0 + vec2(time * 1.2, time * 0.9));
          turbulence += fbm(distortedUV * 12.0 + vec2(time * 2.1, time * 1.4)) * 0.5;
          
          // \u041E\u0441\u043D\u043E\u0432\u043D\u0430\u044F \u0438\u043D\u0442\u0435\u043D\u0441\u0438\u0432\u043D\u043E\u0441\u0442\u044C \u043E\u0433\u043D\u044F
          float fireIntensity = fireShape * turbulence * intensity;
          
          // \u0421\u043E\u0437\u0434\u0430\u0435\u043C \u0433\u0440\u0430\u0434\u0438\u0435\u043D\u0442 \u0442\u0435\u043C\u043F\u0435\u0440\u0430\u0442\u0443\u0440\u044B \u043F\u043E \u0432\u044B\u0441\u043E\u0442\u0435
          float temperatureGradient = smoothstep(0.0, 1.0, scaledY);
          
          // \u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u043C\u0435\u0440\u0446\u0430\u043D\u0438\u0435
          float flicker = 0.9 + 0.1 * sin(time * 8.0 + st.x * 10.0) * sin(time * 6.0 + st.y * 8.0);
          fireIntensity *= flicker;
          
          // \u041E\u043F\u0440\u0435\u0434\u0435\u043B\u044F\u0435\u043C \u0446\u0432\u0435\u0442 \u0432 \u0437\u0430\u0432\u0438\u0441\u0438\u043C\u043E\u0441\u0442\u0438 \u043E\u0442 \u0438\u043D\u0442\u0435\u043D\u0441\u0438\u0432\u043D\u043E\u0441\u0442\u0438 \u0438 \u0432\u044B\u0441\u043E\u0442\u044B
          vec3 fireColor;
          
          if(temperatureGradient < 0.3) {
            // \u041D\u0438\u0437 \u043E\u0433\u043D\u044F - \u0442\u0435\u043C\u043D\u043E-\u043A\u0440\u0430\u0441\u043D\u044B\u0439 \u043A \u043E\u0440\u0430\u043D\u0436\u0435\u0432\u043E\u043C\u0443
            fireColor = mix(baseColor, midColor, temperatureGradient / 0.3);
          } else if(temperatureGradient < 0.7) {
            // \u0421\u0435\u0440\u0435\u0434\u0438\u043D\u0430 - \u043E\u0440\u0430\u043D\u0436\u0435\u0432\u044B\u0439 \u043A \u0436\u0435\u043B\u0442\u043E\u043C\u0443
            fireColor = mix(midColor, topColor, (temperatureGradient - 0.3) / 0.4);
          } else {
            // \u0412\u0435\u0440\u0445 - \u0436\u0435\u043B\u0442\u044B\u0439 \u043A \u0431\u0435\u043B\u043E\u043C\u0443/\u0433\u043E\u043B\u0443\u0431\u043E\u043C\u0443 \u0434\u043B\u044F \u0441\u0430\u043C\u044B\u0445 \u0433\u043E\u0440\u044F\u0447\u0438\u0445 \u0443\u0447\u0430\u0441\u0442\u043A\u043E\u0432
            float hotFactor = (temperatureGradient - 0.7) / 0.3;
            fireColor = mix(topColor, hotColor, hotFactor * fireIntensity);
          }
          
          // \u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u043D\u0435\u043C\u043D\u043E\u0433\u043E \u0441\u0438\u043D\u0435\u0433\u043E \u0434\u043B\u044F \u043E\u0447\u0435\u043D\u044C \u0433\u043E\u0440\u044F\u0447\u0438\u0445 \u0443\u0447\u0430\u0441\u0442\u043A\u043E\u0432
          float hotSpots = smoothstep(0.8, 1.0, fireIntensity) * smoothstep(0.6, 1.0, temperatureGradient);
          fireColor = mix(fireColor, hotColor, hotSpots * 0.3);
          
          // \u0420\u0430\u0441\u0441\u0447\u0438\u0442\u044B\u0432\u0430\u0435\u043C \u043F\u0440\u043E\u0437\u0440\u0430\u0447\u043D\u043E\u0441\u0442\u044C
          float alpha = fireIntensity * (1.0 - temperatureGradient * 0.3);
          alpha = smoothstep(0.1, 0.8, alpha);
          
          // \u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u044D\u0444\u0444\u0435\u043A\u0442 "\u0438\u0441\u0447\u0435\u0437\u043D\u043E\u0432\u0435\u043D\u0438\u044F" \u043D\u0430 \u043A\u0440\u0430\u044F\u0445
          float edgeFade = 1.0 - smoothstep(0.3, 0.5, abs(st.x - 0.5));
          alpha *= edgeFade;
          
          gl_FragColor = vec4(fireColor, alpha);
        }
      `,transparent:!0,blending:K,side:J,depthWrite:!1}),this.fireMaterial}updateFireTime(t){this.fireMaterial&&(this.fireMaterial.uniforms.time.value+=t)}setFireIntensity(t){this.fireMaterial&&(this.fireMaterial.uniforms.intensity.value=t)}setFireHeight(t){this.fireMaterial&&(this.fireMaterial.uniforms.fireHeight.value=t)}setFireColors(t,i,r,s){this.fireMaterial&&(this.fireMaterial.uniforms.baseColor.value.setHex(parseInt(t.replace("#","0x"))),this.fireMaterial.uniforms.midColor.value.setHex(parseInt(i.replace("#","0x"))),this.fireMaterial.uniforms.topColor.value.setHex(parseInt(r.replace("#","0x"))),this.fireMaterial.uniforms.hotColor.value.setHex(parseInt(s.replace("#","0x"))))}static \u0275fac=function(i){return new(i||e)};static \u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"})};var P=class e{updateFire(t){t.scale.y=E.randFloat(.04,.07)}lerp(t,i,r){t&&t[i]!==r&&(t[i]+=(r-t[i])*.1,Math.abs(r-t[i])<.01&&(t[i]=r))}static \u0275fac=function(i){return new(i||e)};static \u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ce=["container"],ye=class e{constructor(t,i,r,s,n,a,o){this.renderer2=t;this.ngZone=i;this.shaderService=r;this.sceneService=s;this.router=n;this.transitionService=a;this.route=o}container;renderer;camera;scene;controls;rocketGroup;stars;fire;clock=new le;mouse=new k;raycaster=new ue;plane=new re(new H(0,0,1),0);rocketTarget=new H;cameraTarget=new H;targetRoute="/cosmos";destroyed=!1;bgAudio=null;starAudio=null;lastStarSoundTime=0;fireHeightValue=1;ngOnInit(){let t=this.transitionService.getFinalTarget();t&&(this.targetRoute=t),this.initScene(),this.initRocket(),this.initStars(),this.setupEventListeners(),this.animate(),setTimeout(()=>{this.transitionService.goWithSmoke(this.targetRoute)},1e4),this.bgAudio=new Audio("/images/advertisers/audio/rocket.mp3"),this.bgAudio.loop=!0,this.bgAudio.volume=1,this.bgAudio.play().catch(()=>{}),this.starAudio=new Audio("/images/advertisers/audio/rocket_push.mp3")}initScene(){this.scene=new ie,this.camera=new te(60,window.innerWidth/window.innerHeight,.1,1e5),this.camera.position.set(5,-15,3),this.cameraTarget.copy(this.camera.position),this.renderer=new fe({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.domElement.style.cursor="crosshair",this.renderer2.appendChild(this.container.nativeElement,this.renderer.domElement),this.controls=new ce(this.camera,this.renderer.domElement),this.controls.target.y=1,this.controls.enableDamping=!0,this.controls.enabled=!1;let t=new he(5592405);this.scene.add(t);let i=new oe(16777215,.4);i.position.set(.7,1,1),this.scene.add(i),this.renderer.setClearColor(0,0)}initRocket(){this.rocketGroup=new I,this.scene.add(this.rocketGroup);let t=new ve;t.setPath("3d/rocket/"),t.load("Rocket.mtl",i=>{i.preload();let r=new ge;r.setMaterials(i),r.setPath("3d/rocket/"),r.load("Rocket.obj",s=>{s.scale.set(.1,.1,.1),s.position.y=-1,this.rocketGroup.add(s);let n=[];for(let h=0;h<=10;h++)n.push(new k(Math.sin(h*.18)*10,(-1+h)*2.5));let a=new ae(n,32),o=this.shaderService.createFireMaterial();this.fire=new F(a,o),this.fire.scale.setScalar(.1),this.rocketGroup.add(this.fire)})})}initStars(){this.stars=new x({color:16777215,size:.2,rangeH:20,rangeV:20,pointCount:400,speed:.1}),this.stars.points.position.y=0,this.scene.add(this.stars)}setupEventListeners(){this.renderer2.listen(this.renderer.domElement,"mousemove",t=>{this.mouse.x=t.clientX/window.innerWidth*2-1,this.mouse.y=-(t.clientY/window.innerHeight)*2+1,this.cameraTarget.x=-this.mouse.x*1,this.cameraTarget.z=3+this.mouse.y*1,this.raycaster.setFromCamera(this.mouse,this.camera),this.raycaster.ray.intersectPlane(this.plane,this.rocketTarget)}),this.renderer2.listen(this.renderer.domElement,"mousedown",t=>{let i=Date.now();this.starAudio&&i-this.lastStarSoundTime>1e3&&(this.starAudio.currentTime=0,this.starAudio.play().catch(()=>{}),this.lastStarSoundTime=i),t.preventDefault(),N(),this.bgAudio&&(this.bgAudio.playbackRate=1.5),new T({value:this.fireHeightValue}).to({value:3},500).easing(d.Cubic.Out).onUpdate(s=>{this.fireHeightValue=s.value,this.shaderService.setFireHeight(this.fireHeightValue)}).start();let r=this.mouse.x<0?-1:1;new T(this.rocketGroup.rotation).to({y:r*Math.PI},900).easing(d.Quadratic.InOut).start(),new T(this.rocketGroup.scale).to({x:.9,y:1.9,z:.9},400).easing(d.Cubic.InOut).start(),this.stars.speedTarget=.5,this.renderer.domElement.style.cursor="none"}),this.renderer2.listen(this.renderer.domElement,"mouseup",()=>{this.bgAudio&&(this.bgAudio.playbackRate=1),new T({value:this.fireHeightValue}).to({value:1},500).easing(d.Cubic.Out).onUpdate(t=>{this.fireHeightValue=t.value,this.shaderService.setFireHeight(this.fireHeightValue)}).start(),new T(this.rocketGroup.scale).to({x:1,y:1,z:1},400).easing(d.Cubic.InOut).start(),this.stars.speedTarget=.05,this.renderer.domElement.style.cursor="crosshair"}),this.renderer2.listen(window,"resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)})}animate(){this.ngZone.runOutsideAngular(()=>{let t=()=>{if(this.destroyed)return;requestAnimationFrame(t),Ee(),this.controls.update();let i=this.clock.getDelta();this.fire&&this.sceneService.updateFire(this.fire),this.stars.updateConstant(),this.sceneService.lerp(this.rocketGroup.position,"y",this.rocketTarget.y),this.sceneService.lerp(this.rocketGroup.position,"x",this.rocketTarget.x),this.sceneService.lerp(this.camera.position,"x",this.cameraTarget.x),this.sceneService.lerp(this.camera.position,"z",this.cameraTarget.z),this.sceneService.lerp(this.stars,"speed",this.stars.speedTarget),this.renderer.render(this.scene,this.camera)};t()})}ngOnDestroy(){this.destroyed=!0,N(),this.stars.points.geometry?.dispose(),Array.isArray(this.fire?.material)?this.fire.material.forEach(t=>t.dispose()):this.fire?.material?.dispose(),this.rocketGroup?.children.forEach(t=>{t instanceof F&&(t.geometry?.dispose(),t.material?.dispose())}),this.scene?.clear(),this.renderer&&(this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer.domElement.remove()),this.renderer=null,this.scene=null,this.camera=null,this.controls=null,this.rocketGroup=null,this.stars=null,this.fire=null,this.bgAudio&&(this.bgAudio.pause(),this.bgAudio.currentTime=0,this.bgAudio=null),this.starAudio&&(this.starAudio.pause(),this.starAudio.currentTime=0,this.starAudio=null)}static \u0275fac=function(i){return new(i||e)(v(z),v(W),v(A),v(P),v(Z),v(de),v(Q))};static \u0275cmp=D({type:e,selectors:[["app-test-page"]],viewQuery:function(i,r){if(i&1&&V(Ce,7),i&2){let s;B(s=q())&&(r.container=s.first)}},decls:4,vars:0,consts:[["container",""],[1,"container"]],template:function(i,r){i&1&&L(0,"app-background-canvas")(1,"div",1,0)(3,"router-outlet")},dependencies:[Y,pe],styles:[".container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:2}"]})};export{ye as TestPage};
