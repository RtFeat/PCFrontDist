import{a as E}from"./chunk-PDOTELFB.js";import{Ba as x,I as y,Ia as A,L as h,P as p,Q as T,aa as O,ba as C,ca as S,e as g,f as l,g as v,ga as _,h as u,j as d,l as f,m as k,ma as $,n as b,p as w,q as c,r as P,u as L,y as M}from"./chunk-VURGYMKM.js";var m=class n{loadingProgress$=new u(0);loadingTasks$=new u([]);loadedCache=new Map;pageConfigs=[{route:"/cosmos",tasks:{images:["/images/cosmos/background.jpg","/images/cosmos/stars.png"],audio:["/images/advertisers/audio/cosmos.mp3"],data:["cosmos-data"]}},{route:"/flight",tasks:{models:["3d/rocket/Rocket.obj","3d/rocket/Rocket.mtl"],audio:["/images/advertisers/audio/rocket.mp3","/images/advertisers/audio/rocket_push.mp3"],data:["flight-data"]}},{route:"/mars",tasks:{images:["/images/mars/surface.jpg","/images/mars/atmosphere.png"],data:["mars-help-data"]}},{route:"/earth",tasks:{images:["/images/earth/commercial.jpg"],data:["commercial-data"]}},{route:"/moon",tasks:{images:["/images/moon/surface.jpg","/images/moon/earth-view.jpg"],data:["history-data"]}},{route:"/",tasks:{images:["/images/advertisers/logo.png"],data:["advertisers-data"]}}];getLoadingProgress(){return this.loadingProgress$.asObservable()}getLoadingTasks(){return this.loadingTasks$.asObservable()}loadDataForRoute(a){if(this.loadedCache.has(a))return d(!0);let e=this.pageConfigs.find(s=>s.route===a);if(!e)return d(!0);let i=[],t=0;e.tasks.images?.forEach(s=>{i.push({id:`img-${t++}`,name:`\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F: ${s.split("/").pop()}`,progress:0,completed:!1})}),e.tasks.audio?.forEach(s=>{i.push({id:`audio-${t++}`,name:`\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0430\u0443\u0434\u0438\u043E: ${s.split("/").pop()}`,progress:0,completed:!1})}),e.tasks.models?.forEach(s=>{i.push({id:`model-${t++}`,name:`\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043C\u043E\u0434\u0435\u043B\u0438: ${s.split("/").pop()}`,progress:0,completed:!1})}),e.tasks.data?.forEach(s=>{i.push({id:`data-${t++}`,name:`\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0434\u0430\u043D\u043D\u044B\u0445: ${s}`,progress:0,completed:!1})}),this.loadingTasks$.next(i),this.loadingProgress$.next(0);let o=[];return e.tasks.images?.forEach((s,r)=>{o.push(this.loadImage(s,`img-${r}`))}),e.tasks.audio?.forEach((s,r)=>{o.push(this.loadAudio(s,`audio-${r}`))}),e.tasks.models?.forEach((s,r)=>{o.push(this.loadModel(s,`model-${r}`))}),e.tasks.data?.forEach((s,r)=>{o.push(this.loadData(s,`data-${r}`))}),o.length===0?d(!0):k(o).pipe(f(()=>(this.loadedCache.set(a,!0),!0)))}loadImage(a,e){return new l(i=>{let t=new Image;t.onload=()=>{this.updateTaskProgress(e,100,!0),i.next(t),i.complete()},t.onerror=()=>{this.updateTaskProgress(e,100,!0),i.next(null),i.complete()},t.onprogress=o=>{if(o.lengthComputable){let s=o.loaded/o.total*100;this.updateTaskProgress(e,s,!1)}},t.src=a})}loadAudio(a,e){return new l(i=>{let t=new Audio;t.oncanplaythrough=()=>{this.updateTaskProgress(e,100,!0),i.next(t),i.complete()},t.onerror=()=>{this.updateTaskProgress(e,100,!0),i.next(null),i.complete()},t.onprogress=()=>{if(t.buffered.length>0){let o=t.buffered.end(0)/t.duration*100;this.updateTaskProgress(e,o,!1)}},t.src=a,t.load()})}loadModel(a,e){return new l(i=>{let t=0,o=setInterval(()=>{t+=Math.random()*20,t>=100?(t=100,this.updateTaskProgress(e,t,!0),clearInterval(o),i.next(!0),i.complete()):this.updateTaskProgress(e,t,!1)},100)})}loadData(a,e){return b(500+Math.random()*1500).pipe(w(()=>d({type:a,data:"mock data"})),P(()=>{this.updateTaskProgress(e,100,!0)}))}updateTaskProgress(a,e,i){let t=this.loadingTasks$.value,o=t.findIndex(s=>s.id===a);if(o!==-1){t[o].progress=e,t[o].completed=i;let s=t.reduce((r,R)=>r+R.progress,0)/t.length;this.loadingProgress$.next(s),this.loadingTasks$.next([...t])}}clearCache(){this.loadedCache.clear()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})};var I=class n{constructor(a,e,i){this.router=a;this.transitionService=e;this.dataLoadingService=i}loadingAudio=null;destroy$=new v;elementRef=M(y);loadingProgress=0;loadingTasks=[];isLoading=!0;loadingError=!1;animationState={isPortrait:!1,isLowHeight:!1};loadingMessages=["\u041F\u043E\u0434\u0433\u043E\u0442\u043E\u0432\u043A\u0430 \u043A\u043E\u0441\u043C\u0438\u0447\u0435\u0441\u043A\u043E\u0433\u043E \u043A\u043E\u0440\u0430\u0431\u043B\u044F...","\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0437\u0432\u0435\u0437\u0434\u043D\u044B\u0445 \u043A\u0430\u0440\u0442...","\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u0434\u0432\u0438\u0433\u0430\u0442\u0435\u043B\u0435\u0439...","\u041F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u0441\u0438\u0441\u0442\u0435\u043C \u043D\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u0438...","\u0418\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u044F \u0431\u043E\u0440\u0442\u043E\u0432\u043E\u0433\u043E \u043A\u043E\u043C\u043F\u044C\u044E\u0442\u0435\u0440\u0430...","\u0413\u043E\u0442\u043E\u0432\u043D\u043E\u0441\u0442\u044C \u043A \u043F\u043E\u043B\u0435\u0442\u0443..."];currentMessage="";messageIndex=0;ngOnInit(){this.updateAnimationState(),this.startLoadingProcess()}startLoadingProcess(){let a=this.transitionService.getNextRoute();if(!a){console.error("No target route specified"),this.handleLoadingError();return}this.startLoadingAudio(),this.startMessageAnimation(),this.dataLoadingService.getLoadingProgress().pipe(c(this.destroy$)).subscribe(e=>{this.loadingProgress=Math.round(e)}),this.dataLoadingService.getLoadingTasks().pipe(c(this.destroy$)).subscribe(e=>{this.loadingTasks=e}),this.dataLoadingService.loadDataForRoute(a).pipe(c(this.destroy$)).subscribe({next:e=>{e?this.completeLoading(a):this.handleLoadingError()},error:e=>{console.error("Loading error:",e),this.handleLoadingError()}})}startLoadingAudio(){this.loadingAudio=new Audio("/images/advertisers/audio/loading.mp3"),this.loadingAudio.loop=!1,this.loadingAudio.volume=.7,setTimeout(()=>{this.loadingAudio?.play().catch(()=>{})},1500)}startMessageAnimation(){this.updateLoadingMessage();let a=setInterval(()=>{this.isLoading?this.updateLoadingMessage():clearInterval(a)},2e3)}updateLoadingMessage(){this.currentMessage=this.loadingMessages[this.messageIndex],this.messageIndex=(this.messageIndex+1)%this.loadingMessages.length}completeLoading(a){return g(this,null,function*(){this.isLoading=!1,this.currentMessage="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430! \u0413\u043E\u0442\u043E\u0432 \u043A \u043F\u043E\u043B\u0435\u0442\u0443!",yield this.delay(2500),this.transitionService.clearNextRoute(),yield this.transitionService.completeTransitionWithSmoke(a)})}handleLoadingError(){return g(this,null,function*(){this.isLoading=!1,this.loadingError=!0,this.currentMessage="\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0434\u0430\u043D\u043D\u044B\u0445. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u043F\u044B\u0442\u043A\u0443.",setTimeout(()=>{this.router.navigate(["/"])},3e3)})}forceTransition(){return g(this,null,function*(){if(this.loadingError){yield this.router.navigate(["/"]);return}let a=this.transitionService.getNextRoute();a&&(this.transitionService.clearNextRoute(),yield this.transitionService.completeTransitionWithSmoke(a))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.loadingAudio&&(this.loadingAudio.pause(),this.loadingAudio.currentTime=0,this.loadingAudio=null)}onResize(a){this.updateAnimationState()}onOrientationChange(a){setTimeout(()=>{this.updateAnimationState()},100)}updateAnimationState(){let a=window.innerHeight>window.innerWidth,e=window.innerHeight<=300;this.animationState={isPortrait:a,isLowHeight:e}}delay(a){return new Promise(e=>setTimeout(e,a))}static \u0275fac=function(e){return new(e||n)(p(A),p(E),p(m))};static \u0275cmp=T({type:n,selectors:[["app-loading-page"]],hostBindings:function(e,i){e&1&&_("resize",function(o){return i.onResize(o)},h)("orientationchange",function(o){return i.onOrientationChange(o)},h)},decls:3,vars:6,consts:[[1,"starship-container"],[1,"new-page"],[1,"old-page"]],template:function(e,i){e&1&&(O(0,"div",0),S(1,"div",1)(2,"div",2),C()),e&2&&$("portrait",i.animationState.isPortrait)("landscape",!i.animationState.isPortrait)("low-height",i.animationState.isLowHeight)},dependencies:[x],styles:["[_nghost-%COMP%]{display:block;height:100vh;width:100vw;position:relative;color:#ca5600;background:#000;overflow:hidden}.starship-container[_ngcontent-%COMP%]{--duration: 5.2s;position:relative;width:100%;height:100%}.old-page[_ngcontent-%COMP%]{position:absolute;inset:0;background:url(/images/loading/room1.jpg) center center no-repeat;background-size:cover;transform:scale(1.5)}.starship-container.portrait[_ngcontent-%COMP%]   .old-page[_ngcontent-%COMP%]{mask:url(/images/loading/vector/tail.svg) center top no-repeat,url(/images/loading/vector/space.svg) center center no-repeat,url(/images/loading/vector/rocket.svg) center center no-repeat;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:10rem 20rem,300% 300%,100% 30%;mask-size:10rem 20rem,300% 300%,100% 30%;animation:_ngcontent-%COMP%_hide-view-portrait var(--duration) cubic-bezier(.975,-.005,0,1.02) infinite forwards}.starship-container.landscape[_ngcontent-%COMP%]   .old-page[_ngcontent-%COMP%]{mask:url(/images/loading/vector/tail.svg) center top no-repeat,url(/images/loading/vector/space-landscape.svg) center center no-repeat,url(/images/loading/vector/rocket.svg) center center no-repeat;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:10rem 30rem,500% 500%,100% 30%;mask-size:10rem 30rem,500% 500%,100% 30%;animation:_ngcontent-%COMP%_hide-view-landscape var(--duration) cubic-bezier(.975,-.005,0,1.02) infinite forwards}.starship-container.landscape.low-height[_ngcontent-%COMP%]   .old-page[_ngcontent-%COMP%]{-webkit-mask-size:10rem 10rem,500% 500%,100% 30%;mask-size:10rem 10rem,500% 500%,100% 30%}@keyframes _ngcontent-%COMP%_hide-view-portrait{0%{-webkit-mask-position:50% 120%,50% 0%,50% 150%;mask-position:50% 120%,50% 0%,50% 150%;transform:scale(1.5)}45%{transform:scale(1)}50%{-webkit-mask-position:50% 120%,50% 80%,50% 60%;mask-position:50% 120%,50% 80%,50% 60%}80%{-webkit-mask-position:50% -60%,50% 140%,50% -70%;mask-position:50% -60%,50% 140%,50% -70%}to{-webkit-mask-position:50% -60%,50% 140%,50% -70%;mask-position:50% -60%,50% 140%,50% -70%;transform:scale(1)}}@keyframes _ngcontent-%COMP%_hide-view-landscape{0%{-webkit-mask-position:50% 120%,50% 0%,50% 150%;mask-position:50% 120%,50% 0%,50% 150%;transform:scale(1.5)}45%{transform:scale(1)}50%{-webkit-mask-position:50% 120%,50% 72%,50% 60%;mask-position:50% 120%,50% 72%,50% 60%}80%{-webkit-mask-position:50% -80%,50% 140%,50% -70%;mask-position:50% -80%,50% 140%,50% -70%}to{-webkit-mask-position:50% -80%,50% 140%,50% -70%;mask-position:50% -80%,50% 140%,50% -70%;transform:scale(1)}}.new-page[_ngcontent-%COMP%]{position:absolute;inset:0;background:url(/images/loading/room2.jpg) center center no-repeat,#111;background-size:cover;animation:_ngcontent-%COMP%_show var(--duration) cubic-bezier(.975,-.005,0,1.02) infinite forwards}@keyframes _ngcontent-%COMP%_show{0%{filter:saturate(0%);opacity:.4}40%{filter:saturate(0%);opacity:.4}80%{filter:saturate(100%);opacity:1}to{filter:saturate(100%)}}@media screen and (max-height: 800px){[_nghost-%COMP%]{font-size:8px}}.labs-follow-me[_ngcontent-%COMP%]{transform:scale(.8)!important}"]})};export{I as LoadingPage};
